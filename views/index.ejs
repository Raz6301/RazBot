<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>×œ×•×— ×‘×§×¨×” - RazBot</title>
  <link rel="stylesheet" href="/style.css">
  <style>
    section.dashboard-card {
      display: none;
    }
    section.dashboard-card.show {
      display: block;
    }
    .button.small {
      font-size: 0.8rem;
      padding: 4px 8px;
      margin: 0 4px;
      border-radius: 6px;
      cursor: pointer;
    }
    .reroll {
      background-color: #ffcc00;
      color: black;
    }
    .end {
      background-color: #ff4444;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <h2>ğŸ§± ×ª×¤×¨×™×˜</h2>
      <ul>
        <li><a href="#stats">ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª</a></li>
        <li><a href="#giveaways">ğŸ ×”×’×¨×œ×•×ª</a></li>
        <li><a href="#messages">ğŸ’¬ ×”×•×“×¢×•×ª</a></li>
        <li><a href="#filters">âŒ ×¡×™× ×•×Ÿ</a></li>
        <li><a href="#ticket">ğŸŸï¸ ×˜×™×§×˜×™×</a></li>
        <li><a href="#invites">ğŸ“¨ ×”×–×× ×•×ª</a></li>
      </ul>
    </aside>

    <main class="main">
      <section id="stats" class="dashboard-card">
        <h2>ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª</h2>
        <div class="stats-box">
          <div class="stat"><strong><%= stats.users %></strong> ××©×ª××©×™×</div>
          <div class="stat"><strong><%= stats.channels %></strong> ×—×“×¨×™×</div>
          <div class="stat"><strong><%= stats.roles %></strong> ×¨×•×œ×™×</div>
        </div>
      </section>

      <section id="giveaways" class="dashboard-card">
        <h2>ğŸ ×™×¦×™×¨×ª ×”×’×¨×œ×” ×—×“×©×”</h2>
        <form method="POST" action="/start-giveaway">
          <input type="text" name="giveawayChannel" placeholder="×©× ×”×—×“×¨">
          <input type="text" name="giveawayDuration" placeholder="××©×š ×”×”×’×¨×œ×” (10m, 1h)">
          <input type="number" name="giveawayWinners" placeholder="××¡×¤×¨ ×–×›×™×">
          <input type="text" name="giveawayPrize" placeholder="×”×¤×¨×¡">
          <button type="submit">ğŸš€ ×”×ª×—×œ ×”×’×¨×œ×”</button>
        </form>

        <h3>ğŸ‰ ×”×’×¨×œ×•×ª ×¤×¢×™×œ×•×ª</h3>
        <ul id="activeGiveawaysList"><li>×˜×•×¢×Ÿ...</li></ul>

        <hr>

        <h3>ğŸ•‘ ×”×’×¨×œ×•×ª ×©×”×¡×ª×™×™××•</h3>
        <ul id="endedGiveawaysList"><li>×˜×•×¢×Ÿ...</li></ul>
      </section>

      <section id="messages" class="dashboard-card">
        <h2>ğŸ’¬ × ×™×”×•×œ ×”×•×“×¢×•×ª</h2>
        <p>ğŸ“¥ ×‘×¨×•×š ×”×‘×: <%= messages.welcome %></p>
        <p>ğŸ”— ×”×–×× ×”: <%= messages.invite %></p>
        <p>âš ï¸ ×©×’×™××”: <%= messages.error %></p>
      </section>

      <section id="filters" class="dashboard-card">
        <h2>âŒ ×¡×™× ×•×Ÿ ××™×œ×™× / ×§×™×©×•×¨×™×</h2>
        <form method="POST" action="/toggle-blockLinks">
          <button type="submit">×œ×™× ×§×™×: <%= config.blockLinks ? "××•×¤×¢×œ" : "×›×‘×•×™" %></button>
        </form>
        <form method="POST" action="/toggle-blockPings">
          <button type="submit">×¤×™× ×’×™×: <%= config.blockPings ? "××•×¤×¢×œ" : "×›×‘×•×™" %></button>
        </form>
        <form method="POST" action="/add-badword">
          <input type="text" name="word" placeholder="×”×•×¡×£ ××™×œ×” ××¡×•×¨×”">
          <button type="submit">â• ×”×•×¡×£</button>
        </form>
      </section>

      <section id="ticket" class="dashboard-card">
        <h2>ğŸŸï¸ ×©×œ×™×—×ª ×˜×™×§×˜</h2>
   <form method="POST" action="/send-ticket-button">
  <input type="text" name="ticketChannel" placeholder="×©× ×”×—×“×¨">
  <input type="text" name="ticketMessage" placeholder="×ª×•×›×Ÿ ×”×”×•×“×¢×”">
  <input type="text" name="closedCategory" placeholder="×©× ×”×§×˜×’×•×¨×™×” ×œ×˜×™×§×˜×™× ×¡×’×•×¨×™×">
  <button type="submit">ğŸ“© ×©×œ×—</button>
</form>
      </section>

      <section id="invites" class="dashboard-card">
        <h2>ğŸ“¨ ×”×–×× ×•×ª</h2>
        <ul id="invitesList"><li>×˜×•×¢×Ÿ...</li></ul>
      </section>
    </main>
  </div>

  <script>
    async function fetchGiveaways() {
      try {
        const res = await fetch("/api/giveaways");
        const giveaways = await res.json();
        const active = giveaways.filter(g => !g.ended);
        const ended = giveaways.filter(g => g.ended);
        const activeList = document.getElementById("activeGiveawaysList");
        const endedList = document.getElementById("endedGiveawaysList");
        activeList.innerHTML = active.length === 0 ? "<li>××™×Ÿ ×›×¨×’×¢ ×”×’×¨×œ×•×ª ×¤×¢×™×œ×•×ª.</li>" : "";
        endedList.innerHTML = ended.length === 0 ? "<li>××™×Ÿ ×¢×“×™×™×Ÿ ×”×’×¨×œ×•×ª ×©×”×¡×ª×™×™××•.</li>" : "";
        active.forEach(g => {
          activeList.innerHTML += `<li><strong>ğŸ ${g.prize}</strong> | ×–×›×™×: ${g.winnerCount} | ××¡×ª×™×™××ª: ${new Date(g.endAt).toLocaleString("he-IL")}
    <form method="POST" action="/reroll-giveaway/${g.messageId}" style="display:inline;">
<button class="button small reroll">ğŸ² ×¨×™×¨×•×œ</button>
</form>

<form method="POST" action="/end-giveaway/${g.messageId}" style="display:inline;">
<button class="button small end">â›” ×¡×™×•×</button>
</form>

          </li>`;
        });
      ended.forEach(g => {
  endedList.innerHTML += `
    <li>
      <strong>ğŸ ${g.prize}</strong> | ×–×›×™×: ${g.winnerCount} | ×”×¡×ª×™×™××”: ${new Date(g.endAt).toLocaleString("he-IL")}
      <form method="POST" action="/reroll-giveaway/${g.messageId}" style="display:inline;">
        <button class="button small reroll">ğŸ² ×¨×™×¨×•×œ</button>
      </form>
      <form method="POST" action="/delete-giveaway" style="display:inline;">
        <input type="hidden" name="giveawayId" value="${g.messageId}">
        <button class="button small delete">ğŸ—‘ï¸ ××—×§</button>
      </form>
    </li>`;
});

      } catch (err) {
        console.error("×©×’×™××” ×‘×˜×¢×™× ×ª ×”×’×¨×œ×•×ª:", err);
      }
    }

    async function fetchInvites() {
      try {
        const res = await fetch("/api/invites");
        const invites = await res.json();
        const list = document.getElementById("invitesList");
        list.innerHTML = invites.length === 0 ? "<li>××™×Ÿ × ×ª×•× ×™ ×”×–×× ×•×ª ×–××™× ×™×.</li>" : "";
        invites.forEach(i => {
          list.innerHTML += `<li><strong>${i.username}</strong> ×”×–××™×Ÿ ${i.count} ××©×ª××©×™×</li>`;
        });
      } catch (err) {
        console.error("×©×’×™××” ×‘×˜×¢×™× ×ª ×”×–×× ×•×ª:", err);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const links = document.querySelectorAll(".sidebar a");
      const saved = localStorage.getItem("lastSection") || "stats";
      showSection(saved);
      links.forEach(link => link.addEventListener("click", e => {
        e.preventDefault();
        showSection(link.getAttribute("href").substring(1));
      }));
      fetchGiveaways();
      fetchInvites();
    });

    function showSection(id) {
      document.querySelectorAll(".dashboard-card").forEach(sec => sec.classList.remove("show"));
      const target = document.getElementById(id);
      if (target) target.classList.add("show");
      history.replaceState(null, null, `#${id}`);
      localStorage.setItem("lastSection", id);
    }
  </script>
</body>
</html>
